name: Test Action

description: Runs the tests

inputs:
  python-versions:
    description: 'Python version to test'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Check out the code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-versions }}
        cache: 'pip'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install pytest

    - name: Install local Sedaro package
      run: |
        pip install ./sedaro

    - name: Create config.py
      run: |
        echo "HOST = '${{ secrets.HOST }}'" >> tests/config.py
        echo "API_KEY = '${{ secrets.API_KEY }}'" >> tests/config.py
        echo "AUTH_HANDLE = '${{ secrets.AUTH_HANDLE }}'" >> tests/config.py

        echo "SIMPLESAT_A_T_ID = '${{ secrets.SIMPLESAT_A_T_ID }}'" >> tests/config.py
        echo "SIMPLESAT_SCENARIO_ID = '${{ secrets.SIMPLESAT_SCENARIO_ID }}'" >> tests/config.py
        echo "WILDFIRE_A_T_ID = '${{ secrets.WILDFIRE_A_T_ID }}'" >> tests/config.py
        echo "WILDFIRE_SCENARIO_ID = '${{ secrets.WILDFIRE_SCENARIO_ID }}'" >> tests/config.py

    - name: Test with pytest
      run: pytest
